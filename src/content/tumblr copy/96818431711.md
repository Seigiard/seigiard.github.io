# Bind-once в Angular, или избавляемся от ненужных проверок и ускоряем Angular.

На одном проекте мы стали замечать, что мобильное приложение, написанное
на AngularJS, начинает притормаживать уже на списках в 20-30 элементов.

«Хм» — сказал я и начал думать, как уменьшить прожорливость Angular.

**Конечно, все очевидно**: в список из 20 элементов каждый пункт выводит
около 10 переменных, обильно сдобренных `ng-show` и прочими `ng-switch`.
Ну и в фоне постоянно крутится цикл, проверяющий, а не изменилась ли
какая-либо переменная, не надо ли срочно перерисовать весь DOM.

Для этого есть прекрасные решения по [оптимизации производительности
длинных списков](http://habrahabr.ru/post/200670/).

Но нам этого не надо, у нас — просто список без интерактивности, который
генерируется один раз и все!

Начинаем искать, как нам вставить переменную в шаблона так, чтобы
показать ее, но не отслеживать впредь — чтобы уменьшить нагрузку.

## Вариант №1: Директива в лоб

    angular.module('app', [])
    .directive('text', function() {        
        return {
            restrict: 'A',
            scope: {
              text: "="
            },
            link: function(scope, element, attrs){
              element.html(scope.text);
            }
        }
    });

    // $scope.word = "word";
    <span text="word"></span>

Работает. Но не очень удобно каждую переменную «директивить». Хочется
большего.

## Вариант №2: Директива по лбу

    angular.module('app', [])
    .directive('bindOnce', function() {
        return {
            scope: true,
            link: function( $scope, $element ) {
                setTimeout(function() {
                    $scope.$destroy();
                }, 0);
            }
        }
    });

    // $scope.word = "word";
    <div bind-once>
        {{word}}
        <div ng-bind="word"></div>
    </div> 

Вот оно — решение! Просто используем `bind-once` и забываем обо всем.

-   [Пример 1](http://jsfiddle.net/Vq93Y/5/): ng-repeat без bind-once.
    При изменении текста в инпуте видны подтормаживания браузера даже на
    свежем MBP. А что говорить о более слабых машинах?
-   [Пример 2](http://jsfiddle.net/Vq93Y/4/): Применяем bind-once к
    каждому элементу ng-repeat. Затыков поменьше, но они есть.
-   [Пример 3](http://jsfiddle.net/Vq93Y/6/): Применяем bind-once для
    родителя над ng-repeat. Выключаем весь скоуп с детьми целиком.
    Задержет нет, все работает плавно.

## Вариант №3: pasvaz.bindonce

Еще один вариант «одноразовой» вставки переменных в шаблон предложен
Паскуалле Вазанна из Венесуэлы:
[bindonce](https://github.com/Pasvaz/bindonce).

Вариант рабочий, но *моем проекте* он показался мне неудобным: надо
использовать иной синтакис и зависеть от предлагаемых автором решений:
`bo-if`, `bo-show` и прочие `bo-href-i` и `bo-href`.

> Вот такое маленькое исследование пришлось провести мне, решая задачу
> «одноразовой» вставки переменных в шаблон. Надеюсь, оно помогло о вам.

<span id="timestamp"> December 11th, 2013 12:12am </span>
